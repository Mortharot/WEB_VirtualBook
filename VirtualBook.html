<!DOCTYPE html>
<html>
	<head>
		<script>	

		var VirtualBook_images_link_array = [];
		
		var VirtualBook_previous_picture;
		var VirtualBook_current_picture;
		var VirtualBook_next_picture;
		
		var VirtualBook_current_index;
		
		var VirtualBook_canvas;
		var VirtualBook_context;
		
		var isMouseDown = false;
		var isAnimating = false;
		var progress = 0;
		var isNext = true;
		
		var animSleepTime = 20;
		var VirtualBook_width;
		var VirtualBook_height;
		
		function show_progress()
		{
			if(progress <= 100 && progress >= 0)
			{
				var width1 = VirtualBook_width*(100-progress)/100;
				var width2 = VirtualBook_width*(progress/2)/100;
				var height = VirtualBook_height;
				
				var shadow_width = 20*progress/100;
				
				VirtualBook_context.clearRect(0,0,VirtualBook_canvas.width, VirtualBook_canvas.height);
				
				if(isNext)
				{
					if(VirtualBook_current_index < VirtualBook_images_link_array.length - 1)
					{
						VirtualBook_context.drawImage(VirtualBook_current_picture,0,0,width1,height,0,0,width1,height);
						VirtualBook_context.drawImage(VirtualBook_next_picture,0,0,width2,height,width1,0,width2,height);
						VirtualBook_context.drawImage(VirtualBook_next_picture,width1+width2,0,width2,height,width1+width2,0,width2,height);
					
						VirtualBook_context.fillStyle = "RGBA(0,0,0,0.4)";
						VirtualBook_context.fillRect(width1-shadow_width,0,shadow_width,height);
						VirtualBook_context.fillRect(width1+width2,0,20-shadow_width,height);
					}
					else
					{
						VirtualBook_context.drawImage(VirtualBook_current_picture,0,0,VirtualBook_width,height,0,0,VirtualBook_width,height);
					}
				}
				else
				{
					if(VirtualBook_current_index > 0)
					{
						VirtualBook_context.drawImage(VirtualBook_previous_picture,0,0,width1,height,0,0,width1,height);
						VirtualBook_context.drawImage(VirtualBook_current_picture,0,0,width2,height,width1,0,width2,height);
						VirtualBook_context.drawImage(VirtualBook_current_picture,width1+width2,0,width2,height,width1+width2,0,width2,height);
						
						VirtualBook_context.fillStyle = "RGBA(0,0,0,0.4)";
						VirtualBook_context.fillRect(width1-shadow_width,0,shadow_width,height);
						VirtualBook_context.fillRect(width1+width2,0,20-shadow_width,height);
					}
					else
					{
						VirtualBook_context.drawImage(VirtualBook_current_picture,0,0,VirtualBook_width,height,0,0,VirtualBook_width,height);
					}
					
				}

			}
		}
		
		function animate()
		{
			if(progress > 50 && progress < 100)
			{
				isAnimating = true;
				progress += 1;
				show_progress();
				setTimeout(animate,animSleepTime);
			}
			else if (progress <= 50 && progress > 0)
			{
				isAnimating = true;
				progress -= 1;
				show_progress();
				setTimeout(animate,animSleepTime);
			}
			else
			{
				if(isNext)
				{
					if(VirtualBook_current_index < VirtualBook_images_link_array.length - 1 && progress == 100)
					{
						++VirtualBook_current_index;
						set_pictures();
						progress = 0;
					}
					show_progress();
				}
				else
				{
					if(VirtualBook_current_index > 0 && progress == 0)
					{
						--VirtualBook_current_index;
						set_pictures();
						progress = 100;
					}
					show_progress();
				}
				isAnimating = false;
			}
		}
		
		function calc_progress(e)
		{
			var xPos = e.clientX - VirtualBook_canvas.offsetLeft;
			progress = 100 - Math.round(100 * xPos / VirtualBook_canvas.width);
		}
		
		function is_in_left_region(e)
		{
			var xPos = e.clientX - VirtualBook_canvas.offsetLeft;
			return (xPos > VirtualBook_width*0.9);
		}
		
		function is_in_right_region(e)
		{
			var xPos = e.clientX - VirtualBook_canvas.offsetLeft;
			return (xPos < VirtualBook_width*0.1);
		}
		
		function set_pictures()
		{
			VirtualBook_current_picture = VirtualBook_images_link_array[VirtualBook_current_index];
			if(VirtualBook_current_index > 0)
			{
				VirtualBook_previous_picture = VirtualBook_images_link_array[VirtualBook_current_index - 1];
			}
			else
			{
				VirtualBook_previous_picture = 0;
			}
			
			//if(VirtualBook_current_index < VirtualBook_images_link_array.lenght)
			{
				VirtualBook_next_picture = VirtualBook_images_link_array[VirtualBook_current_index + 1];
			}
			//else
			{
				//VirtualBook_next_picture = 0;
			}
		}
		
		function init(width, height, images_link_array)
		{
			VirtualBook_width = width;
			VirtualBook_height = height;
			
			for(var i=0; i<images_link_array.length; ++i)
			{
				VirtualBook_images_link_array[i] = new Image();
				VirtualBook_images_link_array[i].src = images_link_array[i];
			}
			
			VirtualBook_current_index = 0;
			set_pictures();
			
			//VirtualBook_previous_picture = VirtualBook_images_link_array[0];
			//VirtualBook_current_picture = VirtualBook_images_link_array[1];
			//VirtualBook_next_picture = VirtualBook_images_link_array[2];
			
			VirtualBook_current_picture.onload = function()
						{
							VirtualBook_canvas = document.getElementById("canv-01"); 
							VirtualBook_canvas.width = VirtualBook_width; 
							VirtualBook_canvas.height =  VirtualBook_height;
							VirtualBook_context = VirtualBook_canvas.getContext("2d");
							
							show_progress();
						}
		}
		
		function mouseMove(e)
		{
			if(isMouseDown)
			{
				calc_progress(e);
				show_progress();
			}
		}
		
		function mouseDown(e)
		{
			if(!isAnimating && is_in_left_region(e))
			{
				isNext = true;
				calc_progress(e);
				show_progress();
				isMouseDown = true;
			}
			else if(!isAnimating && is_in_right_region(e))
			{
				isNext = false;
				calc_progress(e);
				show_progress();
				isMouseDown = true;
			}
		}
		
		function mouseUp()
		{
			if(!isAnimating)
			{
				isMouseDown = false;
				animate();
			}
		}
		</script>
	</head>
	<body onLoad="init(858, 536, ['img0.jpg', 'img1.jpg', 'img2.jpg'])">
		<canvas id="canv-01" onmousemove="mouseMove(event)" onmousedown="mouseDown(event)" onmouseup="mouseUp()" width="800" height="600" style="border: 2px solid"></canvas>
	</body>
</html>