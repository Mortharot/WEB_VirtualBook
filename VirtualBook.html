<!DOCTYPE html>
<html>
	<head>
		<script>	

		var pic1 = new Image();
		var pic2 = new Image();
		
		var canvas01;
		var canv_ctx;
		
		var isMouseDown = false;
		var isAnimating = false;
		var progress = 0;
		var animSleepTime = 20;
		
		/*function animate()
		{
			if(progress <= 100)
			{
				var full_width = pic1.width;
				var width1 = full_width*(100-progress)/100;
				var width2 = full_width*(progress/2)/100;
				var height = pic1.height;
				
				var shadow_width = 20*progress/100;
				
				canv_ctx.clearRect(0,0,canvas01.width, canvas01.height);
				canv_ctx.drawImage(pic1,0,0,width1,height,0,0,width1,height);
				//canv_ctx.drawImage(pic2,0,0,width2+full_width/100*(100-progress),height,width1,0,width2,height);
				canv_ctx.drawImage(pic2,0,0,width2,height,width1,0,width2,height);
				canv_ctx.drawImage(pic2,width1+width2,0,width2,height,width1+width2,0,width2,height);
				canv_ctx.fillStyle = "RGBA(0,0,0,0.4)";
				canv_ctx.fillRect(width1-shadow_width,0,shadow_width,height);
				canv_ctx.fillRect(width1+width2,0,20-shadow_width,height);
				progress += 2;
				setTimeout(animate, 100);
			}
		}*/
		
		function show_progress()
		{
			if(progress <= 100)
			{
				var full_width = pic1.width;
				var width1 = full_width*(100-progress)/100;
				var width2 = full_width*(progress/2)/100;
				var height = pic1.height;
				
				var shadow_width = 20*progress/100;
				
				canv_ctx.clearRect(0,0,canvas01.width, canvas01.height);
				canv_ctx.drawImage(pic1,0,0,width1,height,0,0,width1,height);
				canv_ctx.drawImage(pic2,0,0,width2,height,width1,0,width2,height);
				canv_ctx.drawImage(pic2,width1+width2,0,width2,height,width1+width2,0,width2,height);
				canv_ctx.fillStyle = "RGBA(0,0,0,0.4)";
				canv_ctx.fillRect(width1-shadow_width,0,shadow_width,height);
				canv_ctx.fillRect(width1+width2,0,20-shadow_width,height);

			}
		}
		
		function animate()
		{
			if(progress > 50 && progress < 100)
			{
				isAnimating = true;
				progress += 1;
				show_progress();
				setTimeout(animate,animSleepTime);
			}
			else if (progress <= 50 && progress > 0)
			{
				isAnimating = true;
				progress -= 1;
				show_progress();
				setTimeout(animate,animSleepTime);
			}
			else
			{
				isAnimating = false;
			}
		}
		
		function init()
		{
		pic1.src = "img1.jpg";
		pic2.src = "img2.jpg";
		
			pic1.onload = function()
						{
							canvas01 = document.getElementById("canv-01"); 
							canvas01.width = pic1.width; 
							canvas01.height =  pic1.height;
							canv_ctx = canvas01.getContext("2d");
							
							//animate();
							show_progress(0);
						}
		}
		
		function mouseMove(e)
		{
			if(isMouseDown)
			{
				var xPos = e.clientX - canvas01.offsetLeft;
				//var yPos = e.clientY - canvas01.offsetTop;
				progress = 100 - Math.round(100 * xPos / canvas01.width);
				show_progress(progress);
			}
		}
		
		function mouseDown()
		{
			if(!isAnimating)
			{
				isMouseDown = true;
			}
		}
		
		function mouseUp()
		{
			if(!isAnimating)
			{
				isMouseDown = false;
				animate();
			}
		}
		</script>
	</head>
	<body onLoad="init()">
		<canvas id="canv-01" onmousemove="mouseMove(event)" onmousedown="mouseDown()" onmouseup="mouseUp()" width="800" height="600" style="border: 2px solid"></canvas>
	</body>
</html>